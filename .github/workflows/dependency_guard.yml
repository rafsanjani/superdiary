name: Dependency Guard Baseline Updater

on:
    pull_request:
        types: [opened, edited, synchronize, reopened]

jobs:
    dependency-guard-baseline:
        if: startsWith(github.event.pull_request.title, 'Update dependency')
        runs-on: ubuntu-latest

        steps:
            - name: Checkout PR source branch
              uses: actions/checkout@v5
              with:
                  ref: ${{ github.event.pull_request.head.ref }}
                  repository: ${{ github.event.pull_request.head.repo.full_name }}
                  token: ${{ secrets.GITHUB_TOKEN }}
                  fetch-depth: 0

            - name: Validate Gradle wrapper
              uses: gradle/actions/wrapper-validation@v5

            - name: Setup Java
              uses: actions/setup-java@v5
              with:
                  distribution: 'zulu'
                  java-version: '17'

            - name: Setup Gradle
              uses: gradle/actions/setup-gradle@v5

            - name: Run Dependency Guard Baseline
              run: ./gradlew dependencyGuardBaseline

            - name: Commit and push updated files
              run: |
                  git config user.name "github-actions[bot]"
                  git config user.email "github-actions[bot]@users.noreply.github.com"

                  if [[ -n "$(git status --porcelain)" ]]; then
                    echo "ðŸ”¹ Changes detected, committing..."
                    git add -A
                    git commit -m "chore: update dependency guard baseline"
                    git push origin HEAD:${{ github.event.pull_request.head.ref }}
                  else
                    echo "âœ… No changes to commit."
                  fi
